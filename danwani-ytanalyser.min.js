var totalViews,totalSubs,channelId,uploadId,viewsThreeMonths,likesThreeMonths,commentsThreeMonths,subscribersGained,averageViewPercentage,mostWatchedId,estimatedRevenue=0,averageViewTotal=0,d=new Date,todayString=d.toISOString().split("T")[0];d.setMonth(d.getMonth()-3);var threeMonthString=d.toISOString().split("T")[0];function addToMailingList(){var e=GoogleAuth.currentUser.get();$("#mce-EMAIL").val(e.getBasicProfile().getEmail()),$("#mce-NAME").val(e.getBasicProfile().getEmail()),$("#mce-CHANNEL").val("https://www.youtube.com/channel/"+channelId),$("#mce-YT_DATA").val("totalViews, totalSubs, channelId, uploadId, viewsThreeMonths, likesThreeMonths, commentsThreeMonths, subscribersGained, estimatedRevenue, averageViewPercentage, averageViewTotal, mostWatchedId \n"+totalViews+","+totalSubs+","+channelId+","+uploadId+","+viewsThreeMonths+","+likesThreeMonths+","+commentsThreeMonths+","+subscribersGained+","+estimatedRevenue+","+averageViewPercentage+","+averageViewTotal+","+mostWatchedId),$("#mc_embed_signup").show()}function requestChannelReportForLast90Days(){gapi.client.youtubeAnalytics.reports.query({ids:"channel==MINE",startDate:threeMonthString,endDate:todayString,metrics:"views,likes,comments,subscribersGained"}).execute(function(e){viewsThreeMonths=e.rows[0][0],likesThreeMonths=e.rows[0][1],commentsThreeMonths=e.rows[0][2],subscribersGained=e.rows[0][3],0<likesThreeMonths?$("#likes-to-views").html(likesThreeMonths+" likes = "+Math.round(likesThreeMonths/viewsThreeMonths*100*100)/100+"% of total views."):$("#likes-to-views").html("You've had no likes for this time period"),.04<Math.round(likesThreeMonths/viewsThreeMonths)?($("#likes-to-views-success").show(),$("#likes-to-views").addClass("alert-success")):($("#likes-to-views-warning").show(),$("#likes-to-views").addClass("alert-warning")),0<commentsThreeMonths?$("#comments-to-views").html(commentsThreeMonths+" = "+Math.round(commentsThreeMonths/viewsThreeMonths*100*100)/100+"% of total views."):$("#comments-to-views").html("You've had no comments for this time period"),.005<Math.round(commentsThreeMonths/viewsThreeMonths)?($("#comments-to-views-success").show(),$("#comments-to-views").addClass("alert-success")):($("#comments-to-views-warning").show(),$("#comments-to-views").addClass("alert-warning")),0<subscribersGained?$("#subscribers-gained").html(subscribersGained+" = "+Math.round(subscribersGained/(totalSubs-subscribersGained)*100*100)/100+"% growth."):$("#subscribers-gained").html("You've had no new subscribers for this time period"),.2<Math.round(subscribersGained/(totalSubs-subscribersGained))?($("#subscribers-gained-success").show(),$("#subscribers-gained").addClass("alert-success")):($("#subscribers-gained-warning").show(),$("#subscribers-gained").addClass("alert-warning"))})}function requestTrafficSourcesForTopVideos(){gapi.client.youtubeAnalytics.reports.query({ids:"channel==MINE",dimensions:"video",startDate:threeMonthString,endDate:todayString,maxResults:20,metrics:"views,averageViewPercentage",sort:"-views"}).execute(function(e){(mostWatchedId=e.result.rows[0][0])&&($("#most-watched").html('<iframe id="ytplayer" type="text/html" width="640" height="360"src="https://www.youtube.com/embed/'+mostWatchedId+'?autoplay=1" frameborder="0"></iframe>'),$("#most-watched-success").show());for(var s="",t=0;t<e.result.rows.length;t++)s=s.concat(e.result.rows[t][0]).concat(","),averageViewTotal+=e.result.rows[t][2];averageViewPercentage=averageViewTotal/e.result.rows.length,s=s.slice(0,-1),gapi.client.youtubeAnalytics.reports.query({ids:"channel==MINE",dimensions:"insightTrafficSourceDetail",filters:"video==".concat(s).concat(";insightTrafficSourceType==EXT_URL"),startDate:threeMonthString,endDate:todayString,maxResults:20,metrics:"views",sort:"-views"}).execute(function(e){for(var s=0,t=0,a=0;a<e.result.rows.length;a++)"YouTube"==e.result.rows[a][0]&&(s=e.result.rows[a][1]),t+=e.result.rows[a][1];0<s&&$("#youtube-searches").html(Math.round(s/t*100*100)/100+"%"),.1<Math.round(s/t)?($("#youtube-searches-success").show(),$("#youtube-searches").addClass("alert-success")):($("#youtube-searches-warning").show(),$("#youtube-searches").addClass("alert-warning")),$("#average-view-percentage").html(Math.round(averageViewPercentage)+"%"),50<Math.round(averageViewPercentage)?($("#average-view-percentage-success").show(),$("#average-view-percentage").addClass("alert-success")):($("#average-view-percentage-warning").show(),$("#average-view-percentage").addClass("alert-warning")),addToMailingList()})})}function requestChannelReport(){gapi.client.youtube.channels.list({mine:!0,part:"snippet, contentDetails, statistics"}).execute(function(e){uploadId=e.result.items[0].contentDetails.relatedPlaylists.uploads,channelId=e.result.items[0].id,totalViews=e.result.items[0].statistics.viewCount,totalSubs=e.result.items[0].statistics.subscriberCount;var s=e.result.items[0].snippet.title,t=e.result.items[0].snippet.customUrl;t?$("#channelid").html('<a target="_blank" href="https://www.youtube.com/'+t+'">'+s+"</a>"):channelId?$("#channelid").html('<a target="_blank" href="https://www.youtube.com/channel/'+channelId+'">'+s+"</a>"):$("#channelid").html("No channel found for this account"),requestChannelReportForLast90Days(),requestTrafficSourcesForTopVideos()})}